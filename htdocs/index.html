<!DOCTYPE html>  
<html lang="fr">  
<head>        
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Comptage Accueil</title>
	<!-- <script src="password-protect.js" defer></script> -->
	<!--<link href="bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> 	-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
 <!-- Inclure jQuery pour AJAX -->
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script src="compteur.js"></script>
<script src="daily-counter.js"></script>

	<script>
		var date = new Date();
		var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
		var dateFrancaise = date.toLocaleDateString('fr-FR', options);

	</script>	
	    <!-- Custom styles for this template -->
    <link href="grid.css" rel="stylesheet">
	<meta name="theme-color" content="#7952b3">  
</head>  
<body class="py-4">	
	<!--<header>
		
	<div class="row row-cols-md-4 mb-4">
      <div class="col-3">
      	<img src="logo-haute-def-blanc.jpg" alt="REDON Agglomeration" width="150px" height="76px">
      </div>
      <div class="col-9"><h1 class="mt-3">Compteur de visites ACCUEIL</h1>
    		
    	 </div>
    	 
    </div>
	<hr />
 </header>-->
<main>
	
	
<span style ="font-weight: bold;display: table;margin: 0 auto;text-transform: uppercase;"><script>document.write(dateFrancaise);</script></span>
<div class="container">
	
    
    <!--<p>Chaque clic enregistre une visite</p>-->
    <div class="row titre-tab">
	    <div class="col-6 titre-phys themed-grid-col">
    <h6 class="mt-0">PHYSIQUE</h6>
    <div class="daily-counters">
       
        
        
       
    </div>
</div>
	    <div class="col-6 titre-tel themed-grid-col-pink"><h6 class="mt-0">TÉLÉPHONE</h6></div>
	    <div class="col-3 titre-exp themed-grid-col-grey"><h6 class="mt-0">EXPORTER/AJOUTER</h6></div>
	</div>
    <div class="row row-cols-md-4 mb-4">
      <div class="col themed-grid-col">



			         <p>
							<h5 class="mt-0">France Travail</h5>
							<div id="counter_PoleEmploi">
            					<p>Nombre de clics : <span id="count_PoleEmploi">0</span></p>
        					</div>
							<input name="qtyPoleEmploi" id="numero1" class="buttonCalc physique PoleEmploi form-control" type="text" value="0" title="Faite Entrée pour valider votre addition">
							<button type="button" class="inc physique PoleEmploi" onclick="inc('qtyPoleEmploi'); incrementCounter('count_PoleEmploi')" id="btnPhysPE" data-button-name="btnPhysPE">+</button>		
					 </p>
					 <p>
							<h5 class="mt-0">Environnement</h5>
							<div id="counter_Environnement">
        						<p>Nombre de clics : <span id="count_Environnement">0</span></p>
      						</div>
							<input name="qtyEnviro"  id="numero2" class="buttonCalc physique Environnement form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
							<button onclick="inc('qtyEnviro'); incrementCounter('count_Environnement')" id="btnPhysENV" class="inc physique Environnement" data-button-name="btnPhysENV">+</button>
					 </p>
					 <p>
							<h5 class="mt-0">RDV RA</h5>
							<div id="counter_RdvRa">
        						<p>Nombre de clics : <span id="count_RdvRa">0</span></p>
      						</div>
							<input name="qtyRdv"  class="buttonCalc physique RdvRa form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
							<!--<button onclick="dec('qtyRdv')" class="dec">-</button>-->
							<button onclick="inc('qtyRdv'); incrementCounter('count_RdvRa')" id="btnPhysRDV" class="inc physique RdvRa" data-button-name="btnPhysRDV">+</button>
				   </p>
					<p>
							<h5 class="mt-0">Interne</h5>
							<div id="counter_Interne">
        						<p>Nombre de clics : <span id="count_Interne">0</span></p>
      						</div>
							<input name="qtyInterne"  class="buttonCalc physique Interne form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
							<!--<button onclick="dec('qtyInterne')" class="dec">-</button>-->
							<button onclick="inc('qtyInterne'); incrementCounter('count_Interne')" id="btnPhysINT" class="inc physique Interne" data-button-name="btnPhysINT">+</button>
					</p>

				</div>
				<div class="col themed-grid-col">
					<p>
							<h5 class="mt-0">Mission Locale</h5>
							<div id="counter_MissionLocale">
        						<p>Nombre de clics : <span id="count_MissionLocale">0</span></p>
      						</div>
							<input name="qtyML" class="buttonCalc physique MissionLocale form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
							<button onclick="inc('qtyML'); incrementCounter('count_MissionLocale')" id="btnPhysML" class="inc physique MissionLocale" data-button-name="btnPhysML">+</button>
					</p>
					<p>
							<h5 class="mt-0">Clic</h5>
						    <div id="counter_LeClic">
						        <p>Nombre de clics : <span id="count_LeClic">0</span></p>
						    </div>
							<input name="qtyClic"  class="buttonCalc physique LeClic form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
							<!--<button onclick="dec('qtyClic')" class="dec">-</button>-->
							<button onclick="inc('qtyClic'); incrementCounter('count_LeClic')" id="btnPhysCLIC" class="inc physique LeClic" data-button-name="btnPhysCLIC">+</button>
					</p>
					<p>
					  	<h5 class="mt-0">Autres</h5>
					  	<div id="counter_Autres">
        					<p>Nombre de clics : <span id="count_Autres">0</span></p>
      					</div>
						<input name="qtyAutres"  class="buttonCalc physique Autres form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
						<!--<button onclick="dec('qtyAutres')" class="dec">-</button>-->
						<button onclick="inc('qtyAutres'); incrementCounter('count_Autres')" id="btnPhysAUTRE" class="inc physique Autres" data-button-name="btnPhysAUTRE">+</button>
					</p>

      </div>

      <div class="col themed-grid-col-pink">

			      <p>
						<h5 class="mt-0">Environnement</h5>
						<div id="counter_EnvironnementT">
        					<p>Nombre de clics : <span id="count_EnvironnementT">0</span></p>
      					</div>
						<input name="qtyEnviroT"  class="buttonCalc telephone Environnement form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
						<button onclick="inc('qtyEnviroT'); incrementCounter('count_EnvironnementT')" id="btnTelENV" class="inc telephone Environnement" data-button-name="btnTelENV">+</button>
					 </p>
					 <p>
						<h5 class="mt-0">RA</h5>
						<div id="counter_RdvRaT">
							<p>Nombre de clics : <span id="count_RdvRaT">0</span></p>
						</div>
						<input name="qtyRdvT" class="buttonCalc telephone RdvRa form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
						<!--<button onclick="dec('qtyRdvT')" class="dec">-</button>-->
						<button onclick="inc('qtyRdvT'); incrementCounter('count_RdvRaT')" id="btnTelRDV" class="inc telephone RdvRa" data-button-name="btnTelRDV">+</button>
					</p>
					<p>
						<h5 class="mt-0">Clic</h5>
						<div id="counter_Le ClicT">
        					<p>Nombre de clics : <span id="count_LeClicT">0</span></p>
      					</div>
						<input name="qtyClicT"  class="buttonCalc telephone LeClic form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
						<!--<button onclick="dec('qtyClicT')" class="dec">-</button>-->
						<button onclick="inc('qtyClicT'); incrementCounter('count_LeClicT')" id="btnTelCLIC" class="inc telephone LeClic" data-button-name="btnTelCLIC">+</button>
					</p>
			</div>

      <div class="col themed-grid-col-pink">
					
					<p>
						<h5 class="mt-0">Autres</h5>
						<div id="counter_AutresT">
        					<p>Nombre de clics : <span id="count_AutresT">0</span></p>
      					</div>
						<input name="qtyAutresT"  class="buttonCalc telephone Autres form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
						<!--<button onclick="dec('qtyAutresT')" class="dec">-</button>-->
						<button onclick="inc('qtyAutresT'); incrementCounter('count_AutresT')" id="btnTelAUTRE" class="inc telephone Autres" data-button-name="btnTelAUTRE">+</button>
					</p>
					<p>
						<h5 class="mt-0">Interne</h5>
						<div id="counter_InterneT">
        					<p>Nombre de clics : <span id="count_InterneT">0</span></p>
      					</div>
						<input name="qtyInterneT"  class="buttonCalc telephone Interne form-control" type="text" value="0" title="Tapez la touche Entrée pour valider votre addition">
						<!--<button onclick="dec('qtyInterneT')" class="dec">-</button>-->
						<button onclick="inc('qtyInterneT'); incrementCounter('count_InterneT')" id="btnTelINT" class="inc telephone Interne" data-button-name="btnTelINT">+</button>
					</p>
				</div>
      <div class="col themed-grid-col-grey">

      	<h5 class="mt-0">Voir les résultats et exporter :</h5>

      			<div id ="colForm">
								
								
								  <form  action="export_to_table.php" method="get" target="_blank">
						 			  <div>
						 			 	 <label for="start_date">Date de début :</label>
						  				<input type="date" class="form-control" id="start_date" name="start_date">
						  		  </div>
						   			<div>
						   				<label for="end_date">Date de fin :</label>
						  				<input type="date" class="form-control" id="end_date" name="end_date">
						  			</div>
						  			<div id="validate">
						  				<input  type="submit" class="btn btn-primary"  name="submit"  value="Voir et Exporter">
						  				<!--class="btn btn-primary"-->
						  			</div>
                                                                  </form>

                                                </div>

                                                <p class="mt-3"><a href="stats.html">Statistiques horaires</a></p>

   
				<h5 class="mt-0">Ajouter un ou plusieurs clics :</h5>

      			<div id ="colForm2">
							
								
								  <form id="update-form">
						 			<div>
<label for="date">Quand ?</label>
                                                                         <input type="date" class="form-control" id="date" name="date" required>
                                                                   </div>
                                                                        <div>
                                                                         <label for="clickCount">Nombre de clics :</label>
                                                                         <input type="number" class="form-control" id="clickCount" name="clickCount" value="1" min="1" required>
                                                                         </div>
						  		<div>
						   				<label for="buttonName">Type de contact :</label>
						  				<select name="buttonName" class="form-control"  id="buttonName">
												  <option value="">-- Choisir --</option>
												  <option value="physique">Physique</option>
												  <option value="telephone">Téléphone</option>
											</select>
						  			</div>
						  			<div>
						   				<label for="serviceName">Service :</label>
						  				<select name="serviceName" class="form-control"  id="serviceName">
												  <option value="">-- Choisir --</option>
												  <option value="PoleEmploi">Pôle Emploi</option>
												  <option value="Environnement">Environnement</option>
												  <option value="RdvRa">RDV RA</option>
												  <option value="MissionLocale">Mission Locale</option>
												  <option value="LeClic">Clic</option>
												  <option value="Interne">Interne</option>
												  <option value="Autres">Autres</option>
											</select>
						  			</div>
						  			<div id="validate">
						  				<!--<input id="update-button" class="btn btn-primary" type="submit" name="submit"  value="Ajouter">-->
						  				<button id="update-button" class="btn btn-primary">Ajouter</button>
						  			</div>

						  			<!-- Div pour afficher le message d'alerte -->
    <div id="alert-message" class="mt-3"></div>
								  </form>						   
					</div>
      
    </div>

    
  </div>
	</main>
	<footer>	
	</footer>

	<script>

/*// Envoi donnees ver le serveur
function sendButtonClickData(buttonName, serviceName, inputValue) {

  fetch('compteur-connector.php', {
    method: 'POST',
    body: JSON.stringify({ button: buttonName, service: serviceName, inputValue: inputValue }),
    headers: { 'Content-Type': 'application/json' }
  })

    .then(response => response.text())
    .then(result => {
      console.log(result); 
    })

    .catch(error => console.error('Error:', error));
}

// Attache 1 clic sur un évenement
document.addEventListener('click', function (event) {

  // On vérifie si l'élément cliqué a la classe 'inc'
  if (event.target.classList.contains('inc')) {

    const buttonName = event.target.classList[1];
    const serviceName = event.target.classList[2];
    const inputField = document.querySelector('.buttonCalc');
    const inputValue = parseInt(inputField.value);
    sendButtonClickData(buttonName, serviceName, inputValue);
  }

});*/

	// Envoi donnees ver le serveur
	function sendButtonClickData(buttonName, serviceName, inputValue) {
    let valueToSend = inputValue === 0 ? 1 : inputValue;

    fetch('compteur-connector.php', {
        method: 'POST',
        body: JSON.stringify({ button: buttonName, service: serviceName, inputValue: valueToSend }),
        headers: { 
            'Content-Type': 'application/json',
            'Cache-Control': 'no-cache'
        }
    })
    .then(response => response.text())
    .then(result => {
        console.log(result);
        // Immediately fetch new values after update
        updateCountersFromDB();
    })
    .catch(error => console.error('Error:', error));
}

function updateCountersFromDB() {
    fetch('compteur-service.php?' + new Date().getTime(), {
        method: 'GET',
        headers: {
            'Cache-Control': 'no-store, no-cache, must-revalidate, max-age=0',
            'Pragma': 'no-cache',
            'Expires': '0'
        }
    })
    .then(response => response.json())
    .then(data => {
        for (const [key, value] of Object.entries(data)) {
            const counterElement = document.getElementById('count_' + key);
            if (counterElement) {
                counterElement.innerText = value;
            }
            const telCounterElement = document.getElementById('count_' + key + 'T');
            if (telCounterElement) {
                telCounterElement.innerText = value;
            }
        }
    })
    .catch(error => console.error('Error updating counters:', error));
}

// Remove the setInterval and just call on page load
document.addEventListener('DOMContentLoaded', function() {
    updateCountersFromDB();
});

	


       //compteurs
function incrementCounter(counterId) {
    const counterSpan = document.getElementById(counterId);
    const currentCount = parseInt(counterSpan.innerText);
    const inputField = event.target.previousElementSibling; // Sélectionne le champ d'entrée précédent le bouton
    const inputValue = parseInt(inputField.value);

    const increment = inputValue > 0 ? inputValue : 1;

    const currentDate = new Date().toDateString();
    const lastResetDate = localStorage.getItem('lastResetDate');

    let newCount = currentCount + increment;

    // Initialisation ou vérification du changement de jour
    if (!lastResetDate) {
        localStorage.setItem('lastResetDate', currentDate);
    } else if (lastResetDate !== currentDate) {
        newCount = increment;
        localStorage.setItem('lastResetDate', currentDate);
    }

    localStorage.setItem('dailyCounter', newCount);
    counterSpan.innerText = newCount;
}


























	// Attache 1 clic sur un évenement
	document.addEventListener('click', function (event) {
	  // On vérifie si l'élément cliqué a la classe 'inc'
	  if (event.target.classList.contains('inc') && event.target.tagName.toLowerCase() === 'button') {
  		const buttonName = event.target.classList[1];
	    const serviceName = event.target.classList[2];
	    const inputField = event.target.previousElementSibling; // Sélectionne le champ d'entrée précédent le bouton
	    const inputValue = parseInt(inputField.value);

	    // Pour éviter le +1 sur la saisie du champ on va soustraire à la valeur du champ pour obtenir la valeur souhaité dans la DB
	    //const inputValueFinal = inputValue - 1;

	    console.log('Valeur de inputValue :', inputValue);
	    // Appel de la fonction
	    sendButtonClickData(buttonName, serviceName, inputValue);

        // Trouver le compteur dans la même ligne que le bouton
        const row = event.target.closest('.row'); // Trouver le parent .row
        const counterSpan = row.querySelector('.' + serviceName + ' > div > span'); // Sélectionner le span pour le service correspondant


	        // Si la valeur du champ est 0, passez temporairement à 1, puis réinitialisez à 0 après une courte temporisation
	    if (inputValue === 0) {
	      inputField.value = 1; // Mettez temporairement à 1
	      setTimeout(function () {
	        inputField.value = 0; // Réinitialisez à 0 après une temporisation de 1 seconde (ou le temps que vous souhaitez)
	      }, 1000); // 1000 ms = 1 seconde
	    } else {
	      // Si la valeur du champ n'est pas 0, réinitialisez simplement à 0
	      inputField.value = 0;
	    }


	  }
	});
	// // Attache un événement de soumission de formulaire
	// document.addEventListener('submit', function (event) {
  	// 	event.preventDefault(); // Empêche la soumission normale du formulaire
  	// 	const inputField = form.querySelector('input[type="text"]'); // Sélectionnez le champ d'entrée dans le formulaire
  	// 	const inputValue = parseInt(inputField.value);

  	// 	console.log('Valeur de inputValue :', inputValue);
  	// 	// Appel de la fonction avec la valeur du champ d'entrée
  	// 	sendButtonClickData(buttonName, serviceName, inputValue);
	// });
	


  </script>

<!-- 	<script>
	  // Fonction pour récupérer les données de la base de données et mettre à jour les compteurs
	  function updateCounters() {
	    // Envoi d'une requête AJAX pour récupérer les compteurs de chaque service
	    fetch('compteur-service.php')
	      .then(response => response.json())
	      .then(data => {
	        // Mise à jour des compteurs pour chaque service
	        for (const [key, value] of Object.entries(data)) {
	          document.getElementById('count_' + key).innerText = value;
	          document.getElementById('count_' + key + 'T').innerText = value; // Pour les services mobiles
	        }
	      })
	      .catch(error => console.error('Une erreur s\'est produite lors de la récupération des données des compteurs:', error));
	  }

	  // Appel de la fonction updateCounters pour mettre à jour les compteurs initiaux
	  updateCounters();

	  // Actualisation des compteurs toutes les 5 secondes (ou ajustez selon vos besoins)
	  setInterval(updateCounters, 5000);
	</script> -->


   <script>
        // Fonction pour envoyer le nombre au serveur

        /*function sendDataEnter(event) {
            if (event.key === "Enter") {
    			//const numeroId = event.target.id;
    			//const classe = event.target.className;
    			const buttonName = event.target.classList[1];
    			const numero = event.target.value;
    			const serviceName = event.target.classList[2];
               
                
                
                if (numero.trim() === "") {
                    alert("Veuillez entrer un nombre.");
                    return;
                }

                fetch('compteur-entree.php', {
                    method: 'POST',
                    body: JSON.stringify({ button: buttonName, numero: numero, service: serviceName }),
                      headers: { 'Content-Type': 'application/json' } 
                })
                
                .then(response => response.json())
                .then(data => {
                    alert("Nombre envoyé avec succès à la base de données.");
                    event.target.value = "";
                })
                .catch(error => {
                    console.error("Erreur:", error)
                    
                });
                .then(response => response.text())
      			.then(result => {
       				 console.log(result); 
      				})

      			.catch(error => console.error('Error:', error));
                
            }
        }

        // Écouteur d'événement pour tous les champs input avec la classe "buttonCalc"
        const numeroInputs = document.querySelectorAll(".buttonCalc");
        numeroInputs.forEach(input => {
            input.addEventListener("keyup", sendDataEnter);
      });*/
   </script>


   
<script>
        $(document).ready(function() {
            $("#update-button").click(function(event) {
                event.preventDefault(); // Empêcher le rechargement de la page

                // Récupérer les valeurs du formulaire
                var date = $("#date").val();
                var buttonName = $("#buttonName").val();
                var serviceName = $("#serviceName").val();
                var clickCount = $("#clickCount").val();

                // Envoyer la requête AJAX au script PHP de mise à jour
                $.ajax({
                    type: "POST",
                    url: "add_to_table.php", // Mettez le chemin vers votre script PHP de mise à jour
                    data: {
                        date: date,
                        buttonName: buttonName,
                        serviceName: serviceName,
                        clickCount: clickCount
                    },
                    success: function(response) {
                        // Afficher un message d'alerte Bootstrap
                        $("#alert-message").html('<div class="alert alert-success" role="alert">Ajout éffectué !</div>');

                        setTimeout(function() {
                            $("#alert-message").html('');
                        }, 2000);
                    },
                    error: function() {
                        // Afficher un message d'alerte Bootstrap en cas d'erreur
                        $("#alert-message").html('<div class="alert alert-danger" role="alert">Erreur lors de l\'ajout.</div>');

                        setTimeout(function() {
                            $("#alert-message").html('');
                        }, 2000);
                    }
                });
            });
        });
    </script>














</body>
</html>
